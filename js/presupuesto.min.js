function veoPresupuesto(a){var b=a.toString();$("#presupuesto-visualizado").empty(),$(".presupuestosAnteriores button").css("display","none");try{$("#tooltip").remove()}catch(c){console.log(c)}switch(b){case"2014":$(".titulo h3").text("¿Cómo se distribuyen los $59 mil millones de la Ciudad?"),presupuesto2014(),$("#a2015").css("display","inline");break;case"2015":$(".titulo h3").text("¿Cómo se distribuyen los $86 mil millones de la Ciudad?"),presupuesto2015(),$("#a2014").css("display","inline")}$("#selectedYear").text(b)}function presupuesto2014(){function a(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("y"),i=c.attr("x"),j=parseFloat(c.attr("dy")),k=c.text(null).append("tspan").attr("x",i).attr("y",h).attr("dy",j+"em");a=d.pop();)e.push(a),k.text(e.join(" ")),k.node().getComputedTextLength()>b&&(e.pop(),k.text(e.join(" ")),e=[a],k=c.append("tspan").attr("y",h).attr("x",i).attr("dy",++f*g+j+"em").text(a))})}function b(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}var c,d,e;d=$("#contenedor-visualizacion"),e=$(".referencias"),d3.csv("data/presupuesto2014.csv",function(g){var h=[],i=[],j=[],k=[],l=[],m=[];g.forEach(function(a){h.indexOf(a.jurisdiccion)<0&&(h.push(a.jurisdiccion),m.push(0)),i.indexOf(a.id_jurisdiccion)<0&&i.push(a.id_jurisdiccion),j.indexOf(a.finalidad)<0&&(j.push(a.finalidad),l.push(0)),k.indexOf(a.id_finalidad)<0&&k.push(a.id_finalidad),l[j.indexOf(a.finalidad)]=parseInt(l[j.indexOf(a.finalidad)])+parseInt(a.monto),m[h.indexOf(a.jurisdiccion)]=parseInt(m[h.indexOf(a.jurisdiccion)])+parseInt(a.monto)});for(var n=[],o=0;o<j.length;o++)n[o]=[j[o],l[o],k[o]];n.sort(function(a,b){return d3.descending(a[1],b[1])});for(var p=[],o=0;o<h.length;o++)p[o]=[h[o],m[o],i[o]];p.sort(function(a,b){return d3.descending(a[1],b[1])}),c=function(c,g){"use strict";function i(a){var b=40;return 1===a?E/R*a+100:E/R*a+100+a*b}function k(a){var b=c.max(a,function(a){return parseInt(a.monto,10)}),d=c.scale.linear().domain([0,b]).range([K,L]);a.forEach(function(a){var b={id:a.id_jurisdiccion,radius:d(parseInt(a.monto,10)),monto:a.monto,jurisdiccion:a.jurisdiccion,id_jurisdiccion:a.id_jurisdiccion,finalidad:a.finalidad,id_finalidad:a.id_finalidad,funcion:a.funcion,id_funcion:a.id_funcion,x:Math.random()*D,y:Math.random()*E};J.push(b)}),J.sort(function(a,b){return b.monto-a.monto}),A=c.select("#presupuesto-visualizado").append("svg").attr("width",D),C=A.selectAll("circle").data(J).enter().append("circle").attr("r",0).style("opacity",.9).attr("fill",function(a){return V(a.finalidad)}).attr("stroke-width",1.5).attr("stroke",function(a){return c.rgb(V(a.finalidad)).darker()}).attr("id",function(a){return"bubble_"+a.id_finalidad}).on("mouseover",function(a,b){var d=c.select(this);d.style("stroke-width",3),d.style("opacity",.9),y(a,b,this)}).on("mouseout",function(a,b){z(a,b,this);var d=c.select(this);d.style("stroke-width",1.5),d.style("opacity",function(){return $("#jurisdiccion").hasClass("disabled")?.3:.9})}),C.transition().duration(1500).attr("r",function(a){return a.radius})}function l(a){return a.value<0?0:-Math.pow(a.radius,1.9)}function m(){B=c.layout.force().nodes(J).size([D,E])}function o(){B.gravity(G).charge(l).friction(H).on("tick",function(a){C.each(q(a.alpha)).attr("fill",function(a){return V(a.finalidad)}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("opacity",.9)}),B.start(),x()}function q(a){return function(b){b.x=b.x+(N.x-b.x)*(I+.02)*a,b.y=b.y+(N.y-b.y)*(I+.02)*a}}function r(){B.gravity(-.01).charge(l).friction(.5).on("tick",function(a){C.each(s(a.alpha)).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("fill","#FFF")}),B.start(),w()}function s(a){return function(b){var c=T[b.id_jurisdiccion];try{b.x=b.x+(c.x-b.x)*(I+.02)*a*1.2,b.y=b.y+(c.y-b.y)*(I+.02)*a*1.2}catch(d){console.log(d)}}}function t(){B.gravity(G).charge(l).friction(.9).on("tick",function(a){C.each(u(a.alpha)).attr("fill",function(a){return V(a.finalidad)}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("opacity",.9)}),B.start(),v()}function u(a){return function(b){var c=O[b.id_finalidad];b.x=b.x+(c.x-b.x)*(I+.02)*a*1.2,b.y=b.y+(c.y-b.y)*(I+.02)*a*1.2}}function v(){x();var b=O,d=c.keys(b),e=A.append("g").classed("finalidad",!0).attr("transform","translate(0,"+(E-90)+")").selectAll(".finalidad").data(d);e.enter().append("text").style("opacity",0).attr("class","titulo").attr("x",function(a){return b[a].x}).attr("dy","3em").attr("y",-20).attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return b[a].id}).call(a,130).transition().duration(500).style("opacity",1),e.enter().append("text").style("opacity",0).attr("class","total").attr("x",function(a){return b[a].x}).attr("y",0).attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return"$"+M(b[a].monto)}).transition().duration(750).style("opacity",1)}function w(){x();var b=T,d=c.keys(T),e=A.append("g").classed("jurisdiccion",!0).attr("transform","translate(0,0)").selectAll(".jurisdiccion").data(d);e.enter().append("text").style("opacity",0).attr("class","titulo").attr("x",function(a){return b[a].x}).attr("dy","3em").attr("y",function(a){return b[a].y-20}).style("pointer-events","none").attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return b[a].id}).call(a,130).transition().duration(500).style("opacity",1),e.enter().append("text").style("opacity",0).attr("class","total").attr("x",function(a){return b[a].x}).attr("y",function(a){return b[a].y}).style("pointer-events","none").attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return"$"+M(b[a].monto)}).transition().duration(750).style("opacity",1)}function x(){A.selectAll(".finalidad").remove(),A.selectAll(".jurisdiccion").remove()}function y(a,d,e){c.select(e).attr("stroke","black");var f='<span class="name">Finalidad:</span><span class="value"> '+a.finalidad+"</span><br/>";f+='<span class="name">Función:</span><span class="value"> '+a.funcion+"</span><br/>",f+='<span class="name">Jurisdicción:</span><span class="value"> '+a.jurisdiccion+"</span><br/>",f+='<span class="name">Monto:</span><span class="value"> $'+b(M(a.monto))+"</span>",F.showTooltip(f,c.event)}function z(a,b,d){c.select(d).attr("stroke",function(a){return c.rgb(V(a.finalidad)).darker()}),F.hideTooltip()}for(var A,B,C,D=1200,E=600,F=g("tooltip",300),G=-.01,H=.9,I=.45,J=[],K=3,L=110,M=function(a){return f(1*a)},N={x:D/2,y:E/2},O={},P=0;P<j.length;P++)O[parseInt(n[P][2])]={id:n[P][0],monto:n[P][1],x:(P+1)*D/6,y:E/2};for(var Q=4,R=6,S=250,T={},U=[1,1],P=0;P<h.length;P++)T[parseInt(p[P][2])]={id:p[P][0],monto:p[P][1],x:U[0]*(D-S)/Q,y:i(U[1])},U[0]++,5===U[0]&&(U[0]=1,U[1]++);var V=c.scale.ordinal().domain(j).range(["#ECD078","#D95B43","#C02942","#542437","#53777A"]);c.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};var W={};return W.init=function(a){k(a),m()},W.cambiarVista=function(a){"finalidad"==a?(t(),d.delay(200).animate({height:600},1e3),e.animate({opacity:0},250)):"jurisdiccion"==a?(r(),C.style("opacity",.3),d.animate({height:170*R},500),e.animate({opacity:0},250)):(o(),d.delay(200).animate({height:600},1e3),e.delay(300).animate({opacity:1},350))},W}(d3,CustomTooltip),c.init(g);var q=$(location).attr("href");"/total"==q.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#total").toggleClass("disabled"),c.cambiarVista("total")):"/finalidad"==q.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#finalidad").toggleClass("disabled"),c.cambiarVista("finalidad")):"/jurisdiccion"==q.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#jurisdiccion").toggleClass("disabled"),c.cambiarVista("jurisdiccion")):c.cambiarVista("total")});var f=function(a,b){var c,d,e,f,g,h,i;return i="",f="",g="",a>=1e9?(i=" mil millones",a/=1e9,b=1):a>=1e6?(i=" millones",a/=1e6,b=1):a>=1e5&&(i="",a/=1e5,b=1),h="",b>0?(1>a&&(h="0"),c=String(Math.round(a*Math.pow(10,b))),10>c?(d="0"+c.substr(c.length-b,b),e=""):(d=c.substr(c.length-b,b),e=c.substr(0,c.length-b)),f+h+e.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+"."+d+i+g):(c=String(Math.round(a)),c=c.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),f+c+i+g)};$(document).ready(function(){$("#seleccion a").click(function(){var a=$(this).attr("id");return window.location="#/"+a,$("#seleccion a").removeClass("disabled"),$(this).toggleClass("disabled"),c.cambiarVista(a),!1})})}function presupuesto2015(){function a(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("y"),i=c.attr("x"),j=parseFloat(c.attr("dy")),k=c.text(null).append("tspan").attr("x",i).attr("y",h).attr("dy",j+"em");a=d.pop();)e.push(a),k.text(e.join(" ")),k.node().getComputedTextLength()>b&&(e.pop(),k.text(e.join(" ")),e=[a],k=c.append("tspan").attr("y",h).attr("x",i).attr("dy",++f*g+j+"em").text(a))})}function b(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}var c,d,e;d=$("#contenedor-visualizacion"),e=$(".referencias"),d3.csv("data/presupuesto2015.csv",function(g){var h=[],i=[],j=[],k=[],l=[],m=[];g.forEach(function(a){h.indexOf(a.jurisdiccion)<0&&(h.push(a.jurisdiccion),m.push(0)),i.indexOf(a.id_jurisdiccion)<0&&i.push(a.id_jurisdiccion),j.indexOf(a.finalidad)<0&&(j.push(a.finalidad),l.push(0)),k.indexOf(a.id_finalidad)<0&&k.push(a.id_finalidad),l[j.indexOf(a.finalidad)]=parseInt(l[j.indexOf(a.finalidad)])+parseInt(a.monto),m[h.indexOf(a.jurisdiccion)]=parseInt(m[h.indexOf(a.jurisdiccion)])+parseInt(a.monto)});for(var n=[],o=0;o<j.length;o++)n[o]=[j[o],l[o],k[o]];n.sort(function(a,b){return d3.descending(a[1],b[1])});for(var p=[],o=0;o<h.length;o++)p[o]=[h[o],m[o],i[o]];p.sort(function(a,b){return d3.descending(a[1],b[1])}),c=function(c,g){"use strict";function i(a){var b=40;return 1===a?E/R*a+100:E/R*a+100+a*b}function k(a){var b=c.max(a,function(a){return parseInt(a.monto,10)}),d=c.scale.linear().domain([0,b]).range([K,L]);a.forEach(function(a){var b={id:a.id_jurisdiccion,radius:d(parseInt(a.monto,10)),monto:a.monto,jurisdiccion:a.jurisdiccion,id_jurisdiccion:a.id_jurisdiccion,finalidad:a.finalidad,id_finalidad:a.id_finalidad,funcion:a.funcion,id_funcion:a.id_funcion,x:Math.random()*D,y:Math.random()*E};J.push(b)}),J.sort(function(a,b){return b.monto-a.monto}),A=c.select("#presupuesto-visualizado").append("svg").attr("width",D),C=A.selectAll("circle").data(J).enter().append("circle").attr("r",0).style("opacity",.9).attr("fill",function(a){return V(a.finalidad)}).attr("stroke-width",1.5).attr("stroke",function(a){return c.rgb(V(a.finalidad)).darker()}).attr("id",function(a){return"bubble_"+a.id_finalidad}).on("mouseover",function(a,b){var d=c.select(this);d.style("stroke-width",3),d.style("opacity",.9),y(a,b,this)}).on("mouseout",function(a,b){z(a,b,this);var d=c.select(this);d.style("stroke-width",1.5),d.style("opacity",function(){return $("#jurisdiccion").hasClass("disabled")?.3:.9})}),C.transition().duration(1500).attr("r",function(a){return a.radius})}function l(a){return a.value<0?0:-Math.pow(a.radius,1.9)}function m(){B=c.layout.force().nodes(J).size([D,E])}function o(){B.gravity(G).charge(l).friction(H).on("tick",function(a){C.each(q(a.alpha)).attr("fill",function(a){return V(a.finalidad)}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("opacity",.9)}),B.start(),x()}function q(a){return function(b){b.x=b.x+(N.x-b.x)*(I+.02)*a,b.y=b.y+(N.y-b.y)*(I+.02)*a}}function r(){B.gravity(-.01).charge(l).friction(.5).on("tick",function(a){C.each(s(a.alpha)).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("fill","#FFF")}),B.start(),w()}function s(a){return function(b){var c=T[b.id_jurisdiccion];try{b.x=b.x+(c.x-b.x)*(I+.02)*a*1.2,b.y=b.y+(c.y-b.y)*(I+.02)*a*1.2}catch(d){console.log(d)}}}function t(){B.gravity(G).charge(l).friction(.9).on("tick",function(a){C.each(u(a.alpha)).attr("fill",function(a){return V(a.finalidad)}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("opacity",.9)}),B.start(),v()}function u(a){return function(b){var c=O[b.id_finalidad];b.x=b.x+(c.x-b.x)*(I+.02)*a*1.2,b.y=b.y+(c.y-b.y)*(I+.02)*a*1.2}}function v(){x();var b=O,d=c.keys(b),e=A.append("g").classed("finalidad",!0).attr("transform","translate(0,"+(E-90)+")").selectAll(".finalidad").data(d);e.enter().append("text").style("opacity",0).attr("class","titulo").attr("x",function(a){return b[a].x}).attr("dy","3em").attr("y",-20).attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return b[a].id}).call(a,130).transition().duration(500).style("opacity",1),e.enter().append("text").style("opacity",0).attr("class","total").attr("x",function(a){return b[a].x}).attr("y",0).attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return"$"+M(b[a].monto)}).transition().duration(750).style("opacity",1)}function w(){x();var b=T,d=c.keys(T),e=A.append("g").classed("jurisdiccion",!0).attr("transform","translate(0,0)").selectAll(".jurisdiccion").data(d);e.enter().append("text").style("opacity",0).attr("class","titulo").attr("x",function(a){return b[a].x}).attr("dy","3em").attr("y",function(a){return b[a].y-20}).style("pointer-events","none").attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return b[a].id}).call(a,130).transition().duration(500).style("opacity",1),e.enter().append("text").style("opacity",0).attr("class","total").attr("x",function(a){return b[a].x}).attr("y",function(a){return b[a].y}).style("pointer-events","none").attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return"$"+M(b[a].monto)}).transition().duration(750).style("opacity",1)}function x(){A.selectAll(".finalidad").remove(),A.selectAll(".jurisdiccion").remove()}function y(a,d,e){c.select(e).attr("stroke","black");var f='<span class="name">Finalidad:</span><span class="value"> '+a.finalidad+"</span><br/>";f+='<span class="name">Función:</span><span class="value"> '+a.funcion+"</span><br/>",f+='<span class="name">Jurisdicción:</span><span class="value"> '+a.jurisdiccion+"</span><br/>",f+='<span class="name">Monto:</span><span class="value"> $'+b(M(a.monto))+"</span>",F.showTooltip(f,c.event)}function z(a,b,d){c.select(d).attr("stroke",function(a){return c.rgb(V(a.finalidad)).darker()}),F.hideTooltip()}for(var A,B,C,D=1200,E=600,F=g("tooltip",300),G=-.01,H=.9,I=.45,J=[],K=3,L=70,M=function(a){return f(1*a)},N={x:D/2,y:E/2},O={},P=0;P<j.length;P++)O[parseInt(n[P][2])]={id:n[P][0],monto:n[P][1],x:(P+1)*D/7,y:E/2};for(var Q=4,R=8,S=250,T={},U=[1,1],P=0;P<h.length;P++)T[parseInt(p[P][2])]={id:p[P][0],monto:p[P][1],x:U[0]*(D-S)/Q,y:i(U[1])},U[0]++,5===U[0]&&(U[0]=1,U[1]++);var V=c.scale.ordinal().domain(j).range(["#ECD078","#D95B43","#C02942","#542437","#53777A","#c1dd53"]);c.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};var W={};return W.init=function(a){k(a),m()},W.cambiarVista=function(a){"finalidad"==a?(t(),d.delay(200).animate({height:600},1e3),e.animate({opacity:0},250)):"jurisdiccion"==a?(r(),C.style("opacity",.3),d.animate({height:110*R},500),e.animate({opacity:0},250)):(o(),d.delay(200).animate({height:600},1e3),e.delay(300).animate({opacity:1},350))},W}(d3,CustomTooltip),c.init(g);var q=$(location).attr("href");"/total"==q.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#total").toggleClass("disabled"),c.cambiarVista("total")):"/finalidad"==q.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#finalidad").toggleClass("disabled"),c.cambiarVista("finalidad")):"/jurisdiccion"==q.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#jurisdiccion").toggleClass("disabled"),c.cambiarVista("jurisdiccion")):c.cambiarVista("total")});var f=function(a,b){var c,d,e,f,g,h,i;return i="",f="",g="",a>=1e9?(i=" mil millones",a/=1e9,b=1):a>=1e6?(i=" millones",a/=1e6,b=1):a>=1e5&&(i="",a/=1e5,b=1),h="",b>0?(1>a&&(h="0"),c=String(Math.round(a*Math.pow(10,b))),10>c?(d="0"+c.substr(c.length-b,b),e=""):(d=c.substr(c.length-b,b),e=c.substr(0,c.length-b)),f+h+e.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+"."+d+i+g):(c=String(Math.round(a)),c=c.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),f+c+i+g)};$(document).ready(function(){$("#seleccion a").click(function(){var a=$(this).attr("id");return window.location="#/"+a,$("#seleccion a").removeClass("disabled"),$(this).toggleClass("disabled"),c.cambiarVista(a),!1})})}veoPresupuesto(2015);